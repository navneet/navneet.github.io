import{D as Z,a3 as W,a6 as vt,S as x,i as $,s as tt,T as lt,k as H,e as C,m as K,c as X,a as L,d as j,b as T,F as it,g as z,J as At,V as ct,W as ut,X as ft,q as B,o as D,v as It,a7 as jt,l as Y,a8 as yt,Q as mt,C as Rt,w as _t,x as bt,y as ht,U as wt,B as pt,z as Ot,A as Pt,n as Nt,p as Ct,M as et,R as Xt,t as k,h as q,G as I,j as G}from"./vendor-e13e40a5.js";import{p as Lt}from"./stores-e2f0a4ed.js";import{L as dt,A as Tt}from"./appStore-343e38e2.js";import{t as Q,g as kt,p as qt,I as zt}from"./helpers-7746061f.js";const y={EXERCISE:"exercises",PLANK:"planks"},st=(s={})=>{const t=Object.preventExtensions({name:"",display_name:"",type:y.EXERCISE,region:"",target:"",has_lr:!1,band_pos:0,band_pos_text:""});return Object.assign(t,s)},ee=(s=null)=>{const t=Object.preventExtensions(Object.assign({elapsed:0,duration:0,cycle:0,round:0},st()));return s?Object.assign(t,s):t},se={PREP:-3,BREAK:-2,REST:-1,WORK:1},Ht=()=>({saveWorkout:t=>new Promise(e=>{const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"};let c="https://kalabaaz.pythonanywhere.com";c+="/api/workout/save",fetch(c,a).then(async b=>{b.ok&&e()}).catch(b=>{console.error(b)})})});var Kt=Ht();const Bt=()=>{const{subscribe:s,set:t}=Z(null);return{subscribe:s,setDb:a=>{const b=new DOMParser().parseFromString(a,"text/xml"),l=b.querySelector("parsererror");t(l||b)}}};var F=Bt();const Dt=W(F,s=>{if(!s)return[];const t=s.querySelector("exercises");return Array.from(t.children).map(e=>Object.seal({id:e.tagName,title:Q(e.tagName.replace("_"," "))}))},[]),nt=(s=null)=>{const t=Object.preventExtensions({id:null,title:null,tabatas:3,prep_time:10,time_on:40,time_off:15,rest_time:60,with_equipment:!0,has_plank:!0,pathname:null,rules:{}}),{subscribe:e,set:a,update:c}=Z(t),b=i=>{i=Object.assign(t,i),Dt.subscribe(d=>{if(d.length){const O=Object.fromEntries(d.map(r=>[r.id,0]));i.rules=Object.preventExtensions(Object.assign(O,i.rules))}return!0})(),a(i)},l=(i,u)=>{let d=!1;return c(O=>(u&&!isNaN(u)&&(O.rules[i]=u),d=!0,O)),d},o=(i=null)=>(i||e(d=>i=d)(),Object.entries(i.rules).reduce((u,d)=>u+(isNaN(d[1])?0:d[1]),0)),n=(i=null)=>{i||e(r=>i=r)();const u=o(i);let d=0;return d+=i.prep_time,d+=i.time_on*u*i.tabatas,d+=i.time_off*(u-1)*i.tabatas,d+=i.rest_time*(i.tabatas-1),d},f=(i=null)=>{let u;return e(O=>u=O)(),i?u[i]:u},h=(i=null)=>{i||e(O=>i=O)();const u=Object.fromEntries(Object.entries(i));return u.rules=Object.fromEntries(Object.entries(i.rules)),u};return s&&b(s),{subscribe:e,set:b,get:f,clone:h,update:c,updateRule:l,getTotalTime:n,getTotalExercises:o}},ne=W(F,(s,t)=>{if(!s)return[];const e=s.querySelector("selection_rules");if(!e)return[];const a=[];Array.from(e.children).forEach(c=>{const b={id:c.tagName,title:Q(c.tagName.replace("_"," ")),tabatas:parseInt(c.getAttribute("tabatas")),rest_time:parseInt(c.getAttribute("rest_time")),time_on:parseInt(c.getAttribute("time_on")),time_off:parseInt(c.getAttribute("time_off")),prep_time:parseInt(c.getAttribute("prep_time"))||10},l=Array.from(c.children).map(o=>[o.tagName,parseInt(o.getAttribute("select"))]);b.rules=Object.fromEntries(l),a.push(nt(b))}),t(a)},[]),Mt=(s=nt())=>{const t=Object.preventExtensions({meta:s?s.get():null,[y.EXERCISE]:[],[y.PLANK]:[]}),{subscribe:e,set:a,update:c}=Z(t),b=(r=nt())=>{s=r,F.subscribe(p=>{if(!p)return;const m={};m.meta=n(s.get()),m[y.EXERCISE]=[],m[y.PLANK]=[];for(let E in m.meta.rules){if(!parseInt(m.meta.rules[E]))continue;const R=p.querySelector("exercises > "+E).children;m[y.EXERCISE]=m[y.EXERCISE].concat(u(R,m.meta.rules[E],!1,m.meta.with_equipment))}if(m.meta.with_equipment){const E=Math.random()>.5?1:-1;m[y.EXERCISE]=m[y.EXERCISE].sort((R,w)=>(R.band_pos-w.band_pos)*E)}if(m.meta.has_plank){const E=p.querySelector("planks");m[y.PLANK]=u(E.children,parseInt(E.getAttribute("select")),!0,m.meta.with_equipment)}a(m)})()},l=(r=!1)=>{c(_=>(r===!0&&(_.meta.pathname||(_.meta.pathname=kt(10)),Kt.saveWorkout(_)),dt.setItem("workout",_),_))},o=(r=null)=>{r||e(E=>r=E)();const _=r[y.EXERCISE].length;let p=0;return p+=r.meta.prep_time,p+=r.meta.time_on*_*r.meta.tabatas,p+=r.meta.time_off*(_-1)*r.meta.tabatas,p+=r.meta.rest_time*(r.meta.tabatas-1),p},n=(r=null)=>{r||e(m=>r=m.meta)()();const _=Object.fromEntries(Object.entries(r));return _.rules=Object.fromEntries(Object.entries(r.rules)),_},f=(r=-1,_=y.EXERCISE,p="replace")=>{c(m=>{const E=m[_][r];switch(p){case"delete":d(r,m[_]),_!==y.PLANK&&(m.meta.rules[E.region]-=1);break;case"replace":const R=i(r,m[_],_);R.length&&d(r,m[_],R);break}return m})},h=(r=-1,_=-1,p=y.EXERCISE)=>{r<0||c(m=>{const E=m[p].length;_==-1?_=E-1:_==E&&(_=0);const R=m[p].splice(_,1,m[p][r]);return m[p].splice(r,1,...R),m})},i=(r,_,p)=>{const m=_[r];if(!m)return[];const E=_.filter(N=>N.region===m.region).map(N=>N.name),R=vt(F);let w=p;p==y.EXERCISE&&(w+=" > "+m.region);let g=R.querySelector(w);const A=Array.from(g.children).filter(N=>!E.includes(N.getAttribute("name")));return u(A,1,p==y.PLANK)},u=(r,_,p,m=!0)=>{r=r instanceof Array?r:Array.from(r),m===!1&&(r=r.filter(g=>parseInt(g.getAttribute("band_pos"))==0)),r.length>_&&(r=qt(r,_));let E;O.subscribe(g=>E=g)();let w=[];for(let g in r){const A=Boolean(parseInt(r[g].getAttribute("has_lr"))),N=r[g].getAttribute("name"),v=st();if(v.type=p?y.PLANK:y.EXERCISE,v.name=N,v.display_name=N+(A?" (Right)":""),v.region=r[g].parentElement.tagName,v.target=r[g].getAttribute("target"),v.has_lr=A,v.band_pos=parseInt(r[g].getAttribute("band_pos")),v.band_pos_text=E[r[g].getAttribute("band_pos")],A){const S=Object.assign(st(),v);S.display_name=N+" (Left)",w.push(S)}w.push(v)}return w},d=(r=-1,_=[],p=[])=>{const m=_[r],E=m.has_lr===!0?_.findIndex(R=>R.name==m.name&&R!==m):-1;E>-1&&(_.splice(E,1),r=_.indexOf(m)),p.length?_.splice(r,1,...p):_.splice(r,1)},O=W(F,r=>{if(!r)return{};const _={},p=r.querySelector("band_legends");return Array.from(p.children).forEach(m=>{_[m.getAttribute("id")]=m.getAttribute("title")}),_},{});return{subscribe:e,set:a,update:c,save:l,cloneMeta:n,alterExercise:f,swapExercise:h,getTotalTime:o,get preset(){return s},set preset(r){b(r)}}};var at=Mt();function Ft(s){let t,e;return{c(){t=new jt,e=Y(),this.h()},l(a){t=yt(a),e=Y(),this.h()},h(){t.a=e},m(a,c){t.m(s[1],a,c),z(a,e,c)},p(a,c){c&2&&t.p(a[1])},d(a){a&&j(e),a&&t.d()}}}function Vt(s){let t,e,a,c,b;const l=s[6].default,o=lt(l,s,s[5],null),n=o||Ft(s);return{c(){t=H(),e=C("div"),n&&n.c(),this.h()},l(f){t=K(f),e=X(f,"DIV",{class:!0});var h=L(e);n&&n.l(h),h.forEach(j),this.h()},h(){T(e,"class","tooltip svelte-jacfdc"),it(e,"show",s[0])},m(f,h){z(f,t,h),z(f,e,h),n&&n.m(e,null),s[7](e),a=!0,c||(b=At(document.body,"mousemove",s[3]),c=!0)},p(f,[h]){o?o.p&&(!a||h&32)&&ct(o,l,f,f[5],a?ft(l,f[5],h,null):ut(f[5]),null):n&&n.p&&(!a||h&2)&&n.p(f,a?h:-1),h&1&&it(e,"show",f[0])},i(f){a||(B(n,f),a=!0)},o(f){D(n,f),a=!1},d(f){f&&j(t),f&&j(e),n&&n.d(f),s[7](null),c=!1,b()}}}function Jt(s,t,e){let{$$slots:a={},$$scope:c}=t;const b=u=>{h||(h={x:u.screenX,y:u.screenY},f.style.setProperty("transform",`translateX(${h.x-f.parentNode.offsetLeft}px)`),f.style.setProperty("transition",`transform ${o/10}ms`))};It(()=>{setTimeout(()=>e(0,n=!1),o)});let{body:l=null}=t,{duration:o=1500}=t,{show:n}=t,f,h;function i(u){mt[u?"unshift":"push"](()=>{f=u,e(2,f)})}return s.$$set=u=>{"body"in u&&e(1,l=u.body),"duration"in u&&e(4,o=u.duration),"show"in u&&e(0,n=u.show),"$$scope"in u&&e(5,c=u.$$scope)},[n,l,f,b,o,c,a,i]}class Yt extends x{constructor(t){super();$(this,t,Jt,Vt,tt,{body:1,duration:4,show:0})}}function gt(s){let t,e,a;function c(l){s[5](l)}let b={body:s[0]};return s[1]!==void 0&&(b.show=s[1]),t=new Yt({props:b}),mt.push(()=>Xt(t,"show",c)),{c(){_t(t.$$.fragment)},l(l){bt(t.$$.fragment,l)},m(l,o){ht(t,l,o),a=!0},p(l,o){const n={};o&1&&(n.body=l[0]),!e&&o&2&&(e=!0,n.show=l[1],wt(()=>e=!1)),t.$set(n)},i(l){a||(B(t.$$.fragment,l),a=!0)},o(l){D(t.$$.fragment,l),a=!1},d(l){pt(t,l)}}}function Gt(s){let t,e,a,c;const b=[s[4]()];let l={};for(let n=0;n<b.length;n+=1)l=Rt(l,b[n]);t=new zt({props:l}),t.$on("click",s[3]);let o=s[1]&&gt(s);return{c(){_t(t.$$.fragment),e=H(),o&&o.c(),a=Y()},l(n){bt(t.$$.fragment,n),e=K(n),o&&o.l(n),a=Y()},m(n,f){ht(t,n,f),z(n,e,f),o&&o.m(n,f),z(n,a,f),c=!0},p(n,[f]){const h=f&16?Ot(b,[Pt(n[4]())]):{};t.$set(h),n[1]?o?(o.p(n,f),f&2&&B(o,1)):(o=gt(n),o.c(),B(o,1),o.m(a.parentNode,a)):o&&(Nt(),D(o,1,1,()=>{o=null}),Ct())},i(n){c||(B(t.$$.fragment,n),B(o),c=!0)},o(n){D(t.$$.fragment,n),D(o),c=!1},d(n){pt(t,n),n&&j(e),o&&o.d(n),n&&j(a)}}}function Qt(s,t,e){let a,c,b;et(s,at,u=>e(6,a=u)),et(s,Lt,u=>e(8,b=u));const l=Tt.routine;et(s,l,u=>e(7,c=u));let o="",n=!1;const f=async()=>{if(!a[y.EXERCISE].length){const u=dt.getItem("workout");u&&at.set(u)}if(!a.meta.pathname&&a[y.EXERCISE].length&&at.save(!0),a.meta.pathname){const u={title:"Sweat Workout",text:"Here's the link to your saved workout.",url:`${b.url.origin}${c.tabataLink}/?w=${a.meta.pathname}&`};"canShare"in navigator&&navigator.canShare(u)?await navigator.share(u):"clipboard"in navigator&&(await navigator.clipboard.writeText(u.url),n||(e(0,o="Link Copied!"),e(1,n=!0)))}},h=()=>({icon:`bi bi-${"canShare"in navigator&&navigator.canShare()?"share-fill":"link"}`,title:"Share"});function i(u){n=u,e(1,n)}return[o,n,l,f,h,i]}class ae extends x{constructor(t){super();$(this,t,Qt,Gt,tt,{})}}function Et(s){let t;return{c(){t=C("i"),this.h()},l(e){t=X(e,"I",{class:!0}),L(t).forEach(j),this.h()},h(){T(t,"class","bi bi-check svelte-nz0c3b")},m(e,a){z(e,t,a)},d(e){e&&j(t)}}}function St(s){let t,e,a,c,b;return{c(){t=C("span"),e=C("h6"),a=k("Band:"),c=C("h6"),b=k(s[5]),this.h()},l(l){t=X(l,"SPAN",{class:!0});var o=L(t);e=X(o,"H6",{class:!0});var n=L(e);a=q(n,"Band:"),n.forEach(j),c=X(o,"H6",{class:!0});var f=L(c);b=q(f,s[5]),f.forEach(j),o.forEach(j),this.h()},h(){T(e,"class","svelte-nz0c3b"),T(c,"class","svelte-nz0c3b"),T(t,"class","svelte-nz0c3b")},m(l,o){z(l,t,o),I(t,e),I(e,a),I(t,c),I(c,b)},p(l,o){o&32&&G(b,l[5])},d(l){l&&j(t)}}}function Ut(s){let t,e,a,c,b,l,o,n,f,h,i,u,d,O=Q(s[2].replace("_"," "))+"",r,_,p,m,E,R,w,g=s[1]&&Et(),A=s[4]!==0&&St(s);const N=s[7].default,v=lt(N,s,s[6],null);return{c(){t=C("div"),e=C("span"),a=C("h6"),c=k("Exercise:"),b=H(),l=C("h4"),o=k(s[0]),n=H(),g&&g.c(),f=H(),h=C("span"),i=C("h6"),u=k("Region:"),d=C("h6"),r=k(O),_=k("\xA0("),p=k(s[3]),m=k(")"),E=H(),A&&A.c(),R=H(),v&&v.c(),this.h()},l(S){t=X(S,"DIV",{class:!0});var P=L(t);e=X(P,"SPAN",{class:!0});var V=L(e);a=X(V,"H6",{class:!0});var rt=L(a);c=q(rt,"Exercise:"),rt.forEach(j),b=K(V),l=X(V,"H4",{class:!0});var J=L(l);o=q(J,s[0]),n=K(J),g&&g.l(J),J.forEach(j),V.forEach(j),f=K(P),h=X(P,"SPAN",{class:!0});var U=L(h);i=X(U,"H6",{class:!0});var ot=L(i);u=q(ot,"Region:"),ot.forEach(j),d=X(U,"H6",{class:!0});var M=L(d);r=q(M,O),_=q(M,"\xA0("),p=q(M,s[3]),m=q(M,")"),M.forEach(j),U.forEach(j),E=K(P),A&&A.l(P),R=K(P),v&&v.l(P),P.forEach(j),this.h()},h(){T(a,"class","svelte-nz0c3b"),T(l,"class","svelte-nz0c3b"),T(e,"class","svelte-nz0c3b"),T(i,"class","svelte-nz0c3b"),T(d,"class","svelte-nz0c3b"),T(h,"class","svelte-nz0c3b"),T(t,"class","svelte-nz0c3b")},m(S,P){z(S,t,P),I(t,e),I(e,a),I(a,c),I(e,b),I(e,l),I(l,o),I(l,n),g&&g.m(l,null),I(t,f),I(t,h),I(h,i),I(i,u),I(h,d),I(d,r),I(d,_),I(d,p),I(d,m),I(t,E),A&&A.m(t,null),I(t,R),v&&v.m(t,null),w=!0},p(S,[P]){(!w||P&1)&&G(o,S[0]),S[1]?g||(g=Et(),g.c(),g.m(l,null)):g&&(g.d(1),g=null),(!w||P&4)&&O!==(O=Q(S[2].replace("_"," "))+"")&&G(r,O),(!w||P&8)&&G(p,S[3]),S[4]!==0?A?A.p(S,P):(A=St(S),A.c(),A.m(t,R)):A&&(A.d(1),A=null),v&&v.p&&(!w||P&64)&&ct(v,N,S,S[6],w?ft(N,S[6],P,null):ut(S[6]),null)},i(S){w||(B(v,S),w=!0)},o(S){D(v,S),w=!1},d(S){S&&j(t),g&&g.d(),A&&A.d(),v&&v.d(S)}}}function Zt(s,t,e){let{$$slots:a={},$$scope:c}=t,{name:b,completed:l,region:o,target:n,band_pos:f,band_pos_text:h}=t;return s.$$set=i=>{"name"in i&&e(0,b=i.name),"completed"in i&&e(1,l=i.completed),"region"in i&&e(2,o=i.region),"target"in i&&e(3,n=i.target),"band_pos"in i&&e(4,f=i.band_pos),"band_pos_text"in i&&e(5,h=i.band_pos_text),"$$scope"in i&&e(6,c=i.$$scope)},[b,l,o,n,f,h,c,a]}class re extends x{constructor(t){super();$(this,t,Zt,Ut,tt,{name:0,completed:1,region:2,target:3,band_pos:4,band_pos_text:5})}}export{re as E,nt as P,ee as R,ae as S,F as W,y as a,Dt as b,ne as p,se as r,at as w};
